# 训练不稳定性修复方案

## 问题诊断

### `epam_ntu60_fixed` 配置的严重问题

**准确率波动剧烈，不稳定：**

```
Epoch 5:  18.03% ↗
Epoch 10: 19.02% ↗ 
Epoch 11: 14.92% ↘ (暴跌4%)
Epoch 16: 19.70% ↗ (最高)
Epoch 17: 16.07% ↘ (又跌3.6%)
```

### 根本原因

| 问题 | 原配置 | 影响 |
|------|--------|------|
| **学习率太高** | 0.003 | 在最优点附近震荡，无法稳定收敛 |
| **T_max太长** | 100 | 学习率衰减太慢，长期保持高值 |
| **正则化太弱** | weight_decay=0.00005 | 无法抑制过拟合 |

---

## 稳定版修复 (`epam_ntu60_stable.py`)

### 核心修改

| 参数 | 原值 | 新值 | 原因 |
|------|------|------|------|
| **学习率** | 0.003 | **0.001** | ⬇️ 降低震荡，平稳收敛 |
| **T_max** | 100 | **50** | ⚡ 加快衰减速度 |
| **Weight Decay** | 0.00005 | **0.0001** | ⬆️ 增强正则化（提高2倍） |

### 预期效果

1. ✅ **更稳定**：准确率平滑上升，不再剧烈波动
2. ✅ **更快收敛**：10-15 epochs内稳定
3. ✅ **更高峰值**：目标25-30%（比当前19.7%提升）

---

## 已启动训练

```bash
配置文件: configs/skeleton/posec3d/rgbpose_conv3d/epam_ntu60_stable.py
工作目录: work_dirs/epam_ntu60_stable
GPU: 1,2
```

### 监控命令

```bash
# 实时日志
tail -f work_dirs/epam_ntu60_stable/*/20*.log | grep "acc/RGBPose_1:1_top1"

# 查看准确率趋势
grep "best checkpoint" work_dirs/epam_ntu60_stable/*/20*.log
```

---

## 关键监控指标

训练前10个epoch关注：

1. **准确率曲线是否平滑**
   - ✅ 应该稳定上升
   - ❌ 如果还剧烈波动，需进一步降低LR

2. **gradient norm**
   - ✅ 应该在10-20之间稳定
   - ❌ 如果>30或波动很大，说明还不稳定

3. **loss下降速度**
   - ✅ 应该从20逐渐降到18-19
   - ❌ 如果不下降或震荡，有问题

---

## 如果还是不稳定

### 更激进的修改（备选方案）

```python
# 进一步降低学习率
lr=0.0005  # 从0.001再降一半

# 或使用MultiStepLR（阶梯式衰减）
param_scheduler = [
    dict(type='MultiStepLR',
         milestones=[20, 40],  # 在这些epoch降低LR
         gamma=0.1)             # 每次降为原来的1/10
]

# 增强正则化
weight_decay=0.0003  # 从0.0001提高到0.0003
dropout=0.7          # 从0.6提高到0.7
```

---

## 配置对比

| 版本 | 学习率 | T_max | Weight Decay | 状态 |
|------|--------|-------|--------------|------|
| **optimized** | 0.0015 | 50 | 0.0003 | ❌ 严重过拟合 |
| **fixed** | 0.003 | 100 | 0.00005 | ❌ 剧烈震荡 |
| **stable** | **0.001** | **50** | **0.0001** | ✅ **当前运行** |

---

## 总结

**核心问题**：学习率0.003太高 + 衰减太慢 → 震荡不收敛

**解决方案**：降低LR到0.001 + 加快衰减(T_max=50) → 稳定收敛

**预计**：10-15 epochs后准确率稳定在25-30%，不再剧烈波动。

